import React from 'react';
Ôªø// pages/real-test-ai.tsx
'use client';

;

export default function RealTestAI() {
    const [results, setResults] = useState<any>(null)
    const [loading, setLoading] = useState(false)

    const testAIMatchmaking: any= async () => {
  
        setLoading(true)
        setResults(null)
        
        try {
  const { createClient } = await import('@supabase/supabase-js')
            const supabase: any= createClient(
                process.env.NEXT_PUBLIC_SUPABASE_URL || '',
                process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || ''
            )
            
            const testResults: any = {,
  timestamp: new Date().toISOString(),
                tables: {},
                dataSamples: {},
                errors: []
            }

            // Test 1: Check conversations table
            try {
                const { data: convData, error: convError, count: convCount } = await supabase
                    .from('conversations')
                    .select('*', { count: 'exact' })
                    .limit(5)
                
                testResults.tables.conversations = {
                    exists: !convError,
                    error: convError?.message,
                    count: convCount || 0,
                    hasData: (convData && convData.length > 0)
                }
                
                if (convData && convData.length > 0) {
                    testResults.dataSamples.conversations = convData.slice(0, 2)
                }
            } catch (convErr: any) {
                testResults.errors.push(`Conversations error: ${convErr.message}`)
            }

            // Test 2: Check matches table
            try {
                const { data: matchData, error: matchError, count: matchCount } = await supabase
                    .from('matches')
                    .select('*', { count: 'exact' })
                    .limit(5)
                
                testResults.tables.matches = {
                    exists: !matchError,
                    error: matchError?.message,
                    count: matchCount || 0,
                    hasData: (matchData && matchData.length > 0)
                }
                
                if (matchData && matchData.length > 0) {
                    testResults.dataSamples.matches = matchData.slice(0, 2)
                }
            } catch (matchErr: any) {
                testResults.errors.push(`Matches error: ${matchErr.message}`)
            }

            // Test 3: Try to create a test conversation
            try {
                const testConversation: any= {
                    client_id: 'test-client-' + Date.now(),
                    trainer_id: 'test-trainer-' + Date.now(),
                    status: 'active',
                    created_at: new Date().toISOString()
                }
                
                const { data: newConv, error: createError } = await supabase
                    .from('conversations')
                    .insert([testConversation])
                    .select()
                
                testResults.canCreateConversation = !createError;
                testResults.createError = createError?.message;
                
                // Clean up if we created one
                if (newConv && newConv[0]) {
                    await supabase
                        .from('conversations')
                        .delete()
                        .eq('id', newConv[0].id)
                }
            } catch (createErr: any) {
                testResults.errors.push(`Create conversation error: ${createErr.message}`)
            }

            setResults(testResults)
        } catch (err: any) {
            setResults({
                error: err.message,
                timestamp: new Date().toISOString()
            })
        } finally {
            setLoading(false)
        }
    }

    return (
        <div style={{ padding: '2rem', fontFamily: 'Arial, sans-serif' }}>
            <h1>üîç REAL AI Matchmaking Test</h1>
            <p>Actually testing if tables exist AND work, not just assuming.</p>
            
            <button 
                onClick={testAIMatchmaking}
                disabled={loading}
                style={{
                    padding: '1rem 2rem',
                    backgroundColor: loading ? '#ccc' : '#2196f3',
                    color: 'white',
                    border: 'none',
                    borderRadius: '4px',
                    cursor: loading ? 'not-allowed' : 'pointer',
                    marginTop: '1rem',
                    fontWeight: 'bold'
                }}
            >
                {loading ? 'Testing...' : 'Run REAL AI Matchmaking Test'}
            </button>
            
            {results && (
                <div style={{ marginTop: '2rem' }}>
                    <h2>Test Results</h2>
                    
                    {results.error ? (
                        <div style={{ 
                            padding: '1rem', 
                            backgroundColor: '#ffebee',
                            color: '#c62828',
                            borderRadius: '4px'
                        }}>
                            <h3>Error:</h3>
                            <pre style={{ whiteSpace: 'pre-wrap' }}>{results.error}</pre>
                        </div>
                    ) : (
                        <div>
                            {/* Table Status */}
                            <div style={{ 
                                display: 'grid', 
                                gridTemplateColumns: '1fr 1fr', 
                                gap: '1rem',
                                marginBottom: '2rem'
                            }}>
                                {/* Conversations */}
                                <div style={{ 
                                    padding: '1rem', 
                                    backgroundColor: results.tables.conversations?.exists ? '#e8f5e9' : '#ffebee',
                                    border: `2px solid ${results.tables.conversations?.exists ? '#4caf50' : '#f44336'}`,
                                    borderRadius: '8px'
                                }}>
                                    <h3 style={{ margin: '0 0 0.5rem 0' }}>
                                        conversations Table
                                    </h3>
                                    <p style={{ margin: '0 0 0.5rem 0' }}>
                                        <strong>Status:</strong> {results.tables.conversations?.exists ? '‚úÖ EXISTS' : '‚ùå MISSING'}
                                    </p>
                                    {results.tables.conversations?.exists && (
                                        <>
                                            <p style={{ margin: '0 0 0.5rem 0' }}>
                                                <strong>Records:</strong> {results.tables.conversations.count}
                                            </p>
                                            <p style={{ margin: '0 0 0.5rem 0' }}>
                                                <strong>Has Data:</strong> {results.tables.conversations.hasData ? '‚úÖ YES' : '‚ö† NO DATA YET'}
                                            </p>
                                            <p style={{ margin: '0' }}>
                                                <strong>Can Create:</strong> {results.canCreateConversation ? '‚úÖ YES' : '‚ùå NO'}
                                            </p>
                                        </>
                                    )}
                                    {results.tables.conversations?.error && (
                                        <p style={{ margin: '0.5rem 0 0 0', color: '#d32f2f', fontSize: '0.875rem' }}>
                                            Error: {results.tables.conversations.error}
                                        </p>
                                    )}
                                </div>
                                
                                {/* Matches */}
                                <div style={{ 
                                    padding: '1rem', 
                                    backgroundColor: results.tables.matches?.exists ? '#e8f5e9' : '#ffebee',
                                    border: `2px solid ${results.tables.matches?.exists ? '#4caf50' : '#f44336'}`,
                                    borderRadius: '8px'
                                }}>
                                    <h3 style={{ margin: '0 0 0.5rem 0' }}>
                                        matches Table
                                    </h3>
                                    <p style={{ margin: '0 0 0.5rem 0' }}>
                                        <strong>Status:</strong> {results.tables.matches?.exists ? '‚úÖ EXISTS' : '‚ùå MISSING'}
                                    </p>
                                    {results.tables.matches?.exists && (
                                        <>
                                            <p style={{ margin: '0 0 0.5rem 0' }}>
                                                <strong>Records:</strong> {results.tables.matches.count}
                                            </p>
                                            <p style={{ margin: '0 0 0.5rem 0' }}>
                                                <strong>Has Data:</strong> {results.tables.matches.hasData ? '‚úÖ YES' : '‚ö† NO DATA YET'}
                                            </p>
                                        </>
                                    )}
                                    {results.tables.matches?.error && (
                                        <p style={{ margin: '0.5rem 0 0 0', color: '#d32f2f', fontSize: '0.875rem' }}>
                                            Error: {results.tables.matches.error}
                                        </p>
                                    )}
                                </div>
                            </div>
                            
                            {/* Data Samples */}
                            {(results.dataSamples.conversations || results.dataSamples.matches) && (
                                <div style={{ marginBottom: '2rem' }}>
                                    <h3>Sample Data:</h3>
                                    <pre style={{ 
                                        backgroundColor: '#f5f5f5', 
                                        padding: '1rem', 
                                        borderRadius: '4px',
                                        overflow: 'auto',
                                        maxHeight: '300px'
                                    }}>
                                        {JSON.stringify(results.dataSamples, null, 2)}
                                    </pre>
                                </div>
                            )}
                            
                            {/* Overall Assessment */}
                            <div style={{ 
                                padding: '1rem', 
                                backgroundColor: '#e3f2fd',
                                borderRadius: '8px'
                            }}>
                                <h3>AI Matchmaking Assessment:</h3>
                                <ul>
                                    <li>
                                        <strong>conversations table:</strong> 
                                        {results.tables.conversations?.exists ? ' ‚úÖ EXISTS' : ' ‚ùå MISSING'}
                                        {results.tables.conversations?.exists && results.tables.conversations.hasData && ' with data'}
                                        {results.tables.conversations?.exists && !results.tables.conversations.hasData && ' (empty)'}
                                    </li>
                                    <li>
                                        <strong>matches table:</strong> 
                                        {results.tables.matches?.exists ? ' ‚úÖ EXISTS' : ' ‚ùå MISSING'}
                                        {results.tables.matches?.exists && results.tables.matches.hasData && ' with data'}
                                        {results.tables.matches?.exists && !results.tables.matches.hasData && ' (empty)'}
                                    </li>
                                    <li>
                                        <strong>Can create conversations:</strong> 
                                        {results.canCreateConversation ? ' ‚úÖ YES' : ' ‚ùå NO'}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    )}
                </div>
            )}
            
            <div style={{ 
                marginTop: '2rem', 
                padding: '1rem', 
                backgroundColor: '#fff3e0',
                borderRadius: '8px'
            }}>
                <h3>What this ACTUALLY tests:</h3>
                <ul>
                    <li>‚úÖ Table existence (not just assuming)</li>
                    <li>‚úÖ Table accessibility (can query)</li>
                    <li>‚úÖ Data presence (has records or empty)</li>
                    <li>‚úÖ Write capability (can create new records)</li>
                </ul>
                <p style={{ marginTop: '0.5rem', fontWeight: 'bold' }}>
                    This is REAL validation, not assumption.
                </p>
            </div>
        </div>
    )
}
